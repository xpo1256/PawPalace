{% extends 'base.html' %}

{% block title %}My Favorites - PawPalace{% endblock %}

{% block content %}
<!-- Header Section -->
<section class="bg-gradient-to-r from-red-500 to-pink-600 text-white py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h1 class="text-4xl md:text-5xl font-bold mb-4">
            <i class="fas fa-heart mr-3"></i>
            My Favorite Dogs
        </h1>
        <p class="text-xl text-red-100 max-w-2xl mx-auto">
            Keep track of all the adorable dogs you've fallen in love with
        </p>
    </div>
</section>

<!-- Favorites Content -->
<section class="py-16 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        {% if favorites %}
            <!-- Results Count -->
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-bold text-gray-900">
                    {{ favorites|length }} Favorite Dog{{ favorites|length|pluralize }}
                </h2>
                <a href="{% url 'dogs:list' %}" 
                   class="bg-primary-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-primary-600 transition duration-300">
                    <i class="fas fa-search mr-2"></i>
                    Browse More Dogs
                </a>
            </div>
            
            <!-- Favorites Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                {% for favorite in favorites %}
                    <div class="bg-white rounded-2xl shadow-lg overflow-hidden card-hover relative">
                        <!-- Favorite Badge -->
                        <div class="absolute top-4 right-4 z-10">
                            <button onclick="toggleFavorite({{ favorite.dog.pk }})" 
                                    class="bg-red-500 text-white p-2 rounded-full shadow-lg hover:bg-red-600 transition duration-300"
                                    id="favorite-btn-{{ favorite.dog.pk }}">
                                <i class="fas fa-heart"></i>
                            </button>
                        </div>
                        
                        <div class="relative">
                            <img src="{{ favorite.dog.image.url }}" alt="{{ favorite.dog.name }}" 
                                 class="w-full h-64 object-cover">
                            
                            <!-- Status Badge -->
                            <div class="absolute top-4 left-4">
                                {% if favorite.dog.status == 'available' %}
                                    <span class="bg-green-500 text-white px-3 py-1 rounded-full text-sm font-semibold">
                                        Available
                                    </span>
                                {% elif favorite.dog.status == 'pending' %}
                                    <span class="bg-yellow-500 text-white px-3 py-1 rounded-full text-sm font-semibold">
                                        Pending
                                    </span>
                                {% else %}
                                    <span class="bg-gray-500 text-white px-3 py-1 rounded-full text-sm font-semibold">
                                        Sold
                                    </span>
                                {% endif %}
                            </div>
                            
                            <!-- Price -->
                            <div class="absolute bottom-4 right-4">
                                <span class="bg-primary-500 text-white px-3 py-1 rounded-full text-lg font-bold">
                                    ${{ favorite.dog.price }}
                                </span>
                            </div>
                        </div>
                        
                        <div class="p-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-2">{{ favorite.dog.name }}</h3>
                            <p class="text-gray-600 mb-2">
                                <i class="fas fa-dog mr-1"></i> {{ favorite.dog.breed }}
                            </p>
                            <p class="text-gray-600 mb-2">
                                <i class="fas fa-birthday-cake mr-1"></i> {{ favorite.dog.age_display }}
                            </p>
                            <p class="text-gray-600 mb-2">
                                <i class="fas fa-venus-mars mr-1"></i> {{ favorite.dog.get_gender_display }}
                            </p>
                            <p class="text-gray-600 mb-4">
                                <i class="fas fa-map-marker-alt mr-1"></i> {{ favorite.dog.location }}
                            </p>
                            
                            <!-- Seller Info -->
                            <div class="bg-gray-50 rounded-lg p-3 mb-4">
                                <div class="flex items-center space-x-2">
                                    {% if favorite.dog.seller.profile_image %}
                                        <img src="{{ favorite.dog.seller.profile_image.url }}" 
                                             alt="{{ favorite.dog.seller.full_name }}" 
                                             class="w-8 h-8 rounded-full object-cover">
                                    {% else %}
                                        <div class="w-8 h-8 rounded-full bg-primary-500 flex items-center justify-center">
                                            <i class="fas fa-user text-white text-sm"></i>
                                        </div>
                                    {% endif %}
                                    <div>
                                        <div class="font-medium text-gray-900 text-sm">{{ favorite.dog.seller.full_name }}</div>
                                        <div class="text-xs text-gray-600">Seller</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Health Badges -->
                            <div class="flex gap-2 mb-4">
                                {% if favorite.dog.is_vaccinated %}
                                    <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">
                                        <i class="fas fa-shield-alt mr-1"></i> Vaccinated
                                    </span>
                                {% endif %}
                                {% if favorite.dog.is_neutered %}
                                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs">
                                        <i class="fas fa-check-circle mr-1"></i> Neutered
                                    </span>
                                {% endif %}
                            </div>
                            
                            <!-- Favorited Date -->
                            <div class="text-xs text-gray-500 mb-4">
                                <i class="fas fa-heart mr-1"></i>
                                Added {{ favorite.created_at|timesince }} ago
                            </div>
                            
                            <!-- Actions -->
                            <div class="space-y-2">
                                <a href="{{ favorite.dog.get_absolute_url }}" 
                                   class="w-full bg-primary-500 text-white text-center py-2 px-4 rounded-lg hover:bg-primary-600 transition duration-300 block">
                                    <i class="fas fa-eye mr-1"></i> View Details
                                </a>
                                {% if favorite.dog.status == 'available' %}
                                    <div class="grid grid-cols-2 gap-2">
                                        <a href="{% url 'messaging:send_message' favorite.dog.pk %}" 
                                           class="bg-green-500 text-white text-center py-2 px-3 rounded-lg hover:bg-green-600 transition duration-300 text-sm">
                                            <i class="fas fa-envelope mr-1"></i> Message
                                        </a>
                                        <a href="{% url 'dogs:create_order' favorite.dog.pk %}" 
                                           class="bg-yellow-500 text-white text-center py-2 px-3 rounded-lg hover:bg-yellow-600 transition duration-300 text-sm">
                                            <i class="fas fa-shopping-cart mr-1"></i> Order
                                        </a>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <!-- Empty State -->
            <div class="text-center py-16">
                <div class="mb-6">
                    <i class="fas fa-heart text-6xl text-gray-300"></i>
                </div>
                <h3 class="text-2xl font-semibold text-gray-500 mb-4">No Favorites Yet</h3>
                <p class="text-gray-400 mb-8 max-w-md mx-auto">
                    Start browsing our adorable dogs and click the heart icon to save your favorites here!
                </p>
                <a href="{% url 'dogs:list' %}" 
                   class="bg-primary-500 text-white px-8 py-4 rounded-lg text-lg font-semibold hover:bg-primary-600 transition duration-300 inline-block">
                    <i class="fas fa-search mr-2"></i>
                    Browse Dogs
                </a>
            </div>
        {% endif %}
    </div>
</section>

<!-- Tips Section -->
{% if favorites %}
    <section class="py-16 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="bg-blue-50 rounded-2xl p-8">
                <div class="flex items-start space-x-4">
                    <div class="bg-blue-100 p-3 rounded-lg">
                        <i class="fas fa-lightbulb text-blue-600 text-xl"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold text-blue-900 mb-4">Tips for Your Favorites</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-blue-800 text-sm">
                            <div>
                                <h4 class="font-medium mb-2">Stay in Touch:</h4>
                                <ul class="space-y-1">
                                    <li><i class="fas fa-check text-blue-600 mr-2"></i>Message sellers to ask questions</li>
                                    <li><i class="fas fa-check text-blue-600 mr-2"></i>Arrange meetups to interact with dogs</li>
                                    <li><i class="fas fa-check text-blue-600 mr-2"></i>Express genuine interest early</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-medium mb-2">Before Deciding:</h4>
                                <ul class="space-y-1">
                                    <li><i class="fas fa-check text-blue-600 mr-2"></i>Check health records and vaccination status</li>
                                    <li><i class="fas fa-check text-blue-600 mr-2"></i>Ask about the dog's temperament and training</li>
                                    <li><i class="fas fa-check text-blue-600 mr-2"></i>Consider your living situation and lifestyle</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endif %}

<!-- JavaScript -->
<script>
    function toggleFavorite(dogId) {
        fetch(`/dogs/${dogId}/favorite/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                'Content-Type': 'application/json',
            },
        })
        .then(response => response.json())
        .then(data => {
            if (!data.is_favorited) {
                // Remove the card from favorites page
                const card = document.getElementById(`favorite-btn-${dogId}`).closest('.card-hover');
                card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                card.style.opacity = '0';
                card.style.transform = 'scale(0.9)';
                setTimeout(() => {
                    card.remove();
                    // Check if no favorites left and reload page to show empty state
                    if (document.querySelectorAll('.card-hover').length === 0) {
                        location.reload();
                    }
                }, 500);
            }
        })
        .catch(error => console.error('Error:', error));
    }
</script>
{% endblock %}
