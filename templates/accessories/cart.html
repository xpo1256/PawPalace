{% extends 'base.html' %}
{% load static %}

{% block title %}My Cart - Accessories{% endblock %}

{% block content %}
<section class="py-12 bg-gray-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between mb-8">
      <h1 class="text-3xl font-extrabold text-gray-900">
        <i class="fas fa-shopping-cart mr-2"></i> My Cart
      </h1>
      <a href="{% url 'accessories:list' %}" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">
        <i class="fas fa-arrow-left mr-2"></i> Continue Shopping
      </a>
    </div>

    {% if items %}
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <div class="lg:col-span-2 space-y-4">
        {% for item in items %}
        <div class="bg-white rounded-xl shadow p-4 flex items-center gap-4">
          <div class="w-24 h-24 bg-gray-200 rounded overflow-hidden">
            {% if item.accessory.primary_image %}
            <img src="{{ item.accessory.primary_image.url }}" alt="{{ item.accessory.name }}" class="w-full h-full object-cover">
            {% else %}
            <div class="w-full h-full flex items-center justify-center bg-primary-100">
              <i class="fas fa-paw text-primary-600 text-2xl"></i>
            </div>
            {% endif %}
          </div>
          <div class="flex-1">
            <h3 class="font-semibold text-gray-900">{{ item.accessory.name }}</h3>
            <p class="text-sm text-gray-500">{{ item.accessory.get_category_display }}{% if item.accessory.brand %} • {{ item.accessory.brand }}{% endif %}</p>
            <form method="post" action="{% url 'accessories:update_cart' item.accessory.pk %}" class="mt-2 flex items-center gap-3">
              {% csrf_token %}
              <input type="number" name="quantity" min="0" value="{{ item.quantity }}" class="w-20 px-3 py-2 border border-gray-300 rounded-lg">
              <button type="submit" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200">Update</button>
              <a href="{% url 'accessories:remove_from_cart' item.accessory.pk %}" class="px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200">Remove</a>
            </form>
          </div>
          <div class="text-right">
            <div class="text-sm text-gray-500">Unit</div>
            <div class="text-lg font-semibold text-gray-900">${{ item.accessory.price|floatformat:2 }}</div>
            <div class="text-sm text-gray-500 mt-2">Line</div>
            <div class="text-lg font-semibold text-primary-600">${{ item.line_total|floatformat:2 }}</div>
          </div>
        </div>
        {% endfor %}
      </div>

      <div>
        <div class="bg-white rounded-xl shadow p-6">
          <h4 class="text-lg font-semibold text-gray-900 mb-4">Order Summary</h4>
          <div class="flex items-center justify-between mb-2">
            <span class="text-gray-600">Subtotal</span>
            <span class="font-semibold">${{ total|floatformat:2 }}</span>
          </div>
          <p class="text-xs text-gray-400 mb-4">Taxes and shipping are calculated with the seller.</p>
          <a href="{% url 'messaging:start_conversation' user.pk %}" class="w-full inline-flex justify-center items-center px-4 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700">
            <i class="fas fa-comments mr-2"></i> Contact Seller to Checkout
          </a>
          <p class="text-xs text-gray-500 mt-3">We’ll open messaging so you can finalize the purchase with the seller.</p>
        </div>
      </div>
    </div>
    {% else %}
    <div class="text-center py-16">
      <div class="w-24 h-24 mx-auto mb-6 bg-gray-100 rounded-full flex items-center justify-center">
        <i class="fas fa-shopping-cart text-4xl text-gray-400"></i>
      </div>
      <h3 class="text-2xl font-semibold text-gray-700 mb-3">Your cart is empty</h3>
      <p class="text-gray-500 mb-8 max-w-md mx-auto">Browse accessories and add items to your cart. You can message the seller to complete your purchase.</p>
      <a href="{% url 'accessories:list' %}" class="bg-primary-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-primary-700 transition">Browse Accessories</a>
    </div>
    {% endif %}
  </div>
</section>
{% endblock %}
